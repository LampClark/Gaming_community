<div class="discussion-details">
  <h2><%= @discussion.title %></h2><hr>
  <p><%= @discussion.description %></p>
  <p>Created by: <%= link_to @discussion.user.username, profile_path(@discussion.user) %></p>
  <p><%= time_ago_in_words(@discussion.created_at) %> Ago</p>
  <p>Last updated at: <%= time_ago_in_words(@discussion.updated_at) %></p>
  <% if current_user == @discussion.user %>
    <p><%= link_to "Edit Discussion", edit_discussion_path(@discussion) %></p>
  <% end %>

<% if @discussion.attachments.attached? %>
  <% @discussion.attachments.each do |attachment| %>
    <% if attachment.image? %>
      <div class="image-container">
        <%= image_tag attachment, class: "thumbnail-image" %>
      </div>
    <% else %>
      <p><%= link_to attachment.filename, rails_blob_path(attachment) %></p>
    <% end %>
  <% end %>
<% end %>
</div>

<% @discussion.posts.each do |post| %>
  <div>
    <p><strong><%= link_to post.user.username, profile_path(post.user) %></strong></p>
    <p><%= post.content %></p>
    <p><%= time_ago_in_words(post.created_at) %> Ago</p>
    <p>Last updated: <%= time_ago_in_words(post.updated_at) %></p>
  </div>
<% end %>

<% if current_user %>
  <%= form_with(model: [@discussion, @discussion.posts.build], url: discussion_posts_path(@discussion), local: true) do |form| %>
    <%= form.text_area :content, placeholder: "Enter your thread content" %>
    <%= form.submit "Post Thread" %>
  <% end %>
<% else %>
  <p>Please <%= link_to "sign up", new_user_registration_path %> or <%= link_to "log in", new_user_session_path %> to post a thread.</p>
<% end %>
